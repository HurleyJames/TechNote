## OkHttp之缓存配置详解

### 前言

通过把重复请求的数据缓存在本地，并设置超时时间，在规定时间内，客户端不再向远程请求数据，而是直接从本地缓存中取数据。这样可以提高了响应速度，节省网络带宽。

### 重要概念

#### Cache-Control

Cache-Control是由服务器返回的Response中添加的头信息，目的是告诉客户端要从本地读取缓存还是直接从服务器获取数据。它有不同的值，每一个值有不同的作用。

* max-age：告诉浏览器将页面缓存多长时间，超过这个时间后才再次向服务器发起请求检查页面是否有更新。对于静态的页面，比如图片、CSS、JavaScript，一般不会进行较大变更，所以通常将存储这些内容的时间设置为较长时间。这样浏览器反复发起请求，也不会去检查是否更新
* s-maxage：告诉缓存服务器（proxy，如Squid）的缓存页面的时间。如果不单独指定，缓存服务器将使用s-maxage。对于动态内容（比如文档的查看页面），可以告诉浏览器很快就会过时（max-age=0），并告诉缓存服务器（Squid）保留内容一段时间（比如s-maxage=7200）。一旦更新了动态内容，就告诉Squid清除老的缓存版本
* max-stale：指示客户机可以接受超出超时期间的响应消息。如果指定max-stale消息的值，那么客户机可以接受超出超时期指定值之间的响应消息
* must-revalidate：告诉浏览器，一旦缓存的内容过期，一定要向浏览器询问是否有新版本
* proxy-revalidate：proxy上的缓存一旦过期，一定要向服务器询问是否有新版本
* no-cache：不进行缓存
* no-store：数据不在硬盘中临时保存，对需要保密的内容比较重要
* public：告诉服务器，一些不该缓存的内容也要缓存，比如当用户已经认证时，所有的静态内容（图片、JavaScript、CSS等）应该是public的
* private：告诉proxy不要缓存，但是浏览器可以使用private cache进行缓存。一般登录后的个性化页面是private的
* no-transform：告诉proxy不进行转换，比如告诉手机浏览器不要下载某些图片

在OkHttp开发中常用的下面几个属性：

* max-age
* no-cache
* max-stale